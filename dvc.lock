schema: '2.0'
stages:
  download_model:
    cmd:
    - "docker run \\\n  -v \"$(pwd)\"/models/weights:/usr/src/app/models/weights \\\
      \n  yolov5-dvc:latest \\\n  python3 -c \"from utils.downloads import attempt_download;\
      \ attempt_download(f'models/weights/yolov5s.pt')\"\n"
    params:
      params.yaml:
        train:
          weights_dir: models/weights
          weights: yolov5s.pt
          hyp: data/hyps/hyp.scratch-low.yaml
          epochs: 3
          batch_size: 16
          img_size: 32
          optimizer: Adam
          workers: 8
          project: runs/train
          entity:
          label_smoothing: 0.0
          bbox_interval: -1
          save_period: -1
          artifact_alias: latest
          yolo_flags: --exist-ok
    outs:
    - path: models/weights/yolov5s.pt
      md5: 523cc152dea05959e1a07f04fb43ebcf
      size: 14808437
  train:
    cmd: docker run -v "$(pwd)"/data_configs:/usr/src/app/data_configs -v $(pwd)/datasets:/usr/src/datasets
      -v "$(pwd)"/models/weights:/usr/src/app/models/weights -v "$(pwd)"/runs:/usr/src/app/runs  yolov5-dvc:latest  python3
      train.py  --data data_configs/coco128.yaml --weights models/weights/yolov5s.pt  --hyp
      data/hyps/hyp.scratch-low.yaml  --epochs 3  --batch-size 16  --img-size 32  --optimizer
      Adam  --workers 8  --project runs/train  --name '' --label-smoothing 0.0  --save-period
      -1  --entity None  --bbox_interval -1  --artifact_alias latest --exist-ok
    deps:
    - path: models/weights/yolov5s.pt
      md5: 523cc152dea05959e1a07f04fb43ebcf
      size: 14808437
    params:
      params.yaml:
        train:
          weights_dir: models/weights
          weights: yolov5s.pt
          hyp: data/hyps/hyp.scratch-low.yaml
          epochs: 3
          batch_size: 16
          img_size: 32
          optimizer: Adam
          workers: 8
          project: runs/train
          entity:
          label_smoothing: 0.0
          bbox_interval: -1
          save_period: -1
          artifact_alias: latest
          yolo_flags: --exist-ok
    outs:
    - path: runs/train/F1_curve.png
      md5: dc493a727db7c507d62d54566f93bbc2
      size: 93443
    - path: runs/train/PR_curve.png
      md5: 7f6ee5c17fcd27e6eeadfcc15f74dea6
      size: 74254
    - path: runs/train/P_curve.png
      md5: 58a9d81181ad729f60eb410cf046bf1f
      size: 151700
    - path: runs/train/R_curve.png
      md5: 088eb966d3ab65aa581fd91c36662512
      size: 102414
    - path: runs/train/confusion_matrix.png
      md5: 633c2cfc9542af88e8fc06f40a609900
      size: 553826
    - path: runs/train/hyp.yaml
      md5: 0b99b67c046abfdcc69005b3d8db9e83
      size: 373
    - path: runs/train/labels.jpg
      md5: dcd2672956db13bacd2d56ea18a74186
      size: 245726
    - path: runs/train/labels_correlogram.jpg
      md5: aaf6ec90cd751d5f88fad529d0ca5147
      size: 211515
    - path: runs/train/results.csv
      md5: 3d23db33e2b4725ca155656aab67aaf7
      size: 1176
    - path: runs/train/results.png
      md5: f1da31e170b71750dbfb55781960d483
      size: 285108
    - path: runs/train/weights/best.pt
      md5: 7cbc508453eb0c255d45eb8c843bd356
      size: 14641469
    - path: runs/train/weights/last.pt
      md5: cc75def44635627b59f5fd3e67920521
      size: 14641469
  val:
    cmd: docker run --ipc=host -v "$(pwd)"/data_configs:/usr/src/app/data_configs
      -v $(pwd)/datasets:/usr/src/datasets -v "$(pwd)"/runs:/usr/src/app/runs  yolov5-dvc:latest
      python3 val.py --data data_configs/coco128.yaml --weights runs/train/weights/best.pt
      --batch-size  32 --img-size 640 --conf-thres 0.001 --iou-thres 0.6 --max-det
      50 --task val --project runs/val --name '' --verbose --save-conf --save-json
      --exist-ok
    deps:
    - path: runs/train/weights/best.pt
      md5: 7cbc508453eb0c255d45eb8c843bd356
      size: 14641469
    params:
      params.yaml:
        val:
          batch_size: 32
          img_size: 640
          conf_thres: 0.001
          iou_thres: 0.6
          max_det: 50
          workers: 8
          project: runs/val
          yolo_flags: --verbose --save-conf --save-json --exist-ok
    outs:
    - path: runs/val/F1_curve.png
      md5: 1a4bff12a192a9c20fc17c62f278c50f
      size: 59366
    - path: runs/val/PR_curve.png
      md5: 71508db3eba801716ec28404292bbb19
      size: 68526
    - path: runs/val/P_curve.png
      md5: 274911532292cce3ca274bed85acfbd0
      size: 85231
    - path: runs/val/R_curve.png
      md5: 8280cc75cf8f2106a7f640ffe953271b
      size: 61126
    - path: runs/val/best_predictions.json
      md5: 8adc1a5bd8622442fcb636df83d7cedf
      size: 43896
    - path: runs/val/confusion_matrix.png
      md5: 097c8fe82024476c26a2883c7b3f18ac
      size: 553391
  exports@2:
    cmd: docker run --ipc=host  -v $(pwd)/datasets:/usr/src/datasets -v "$(pwd)"/runs:/usr/src/app/runs  yolov5-dvc:latest
      python3 export.py  --data data_configs/coco128.yaml --weights runs/train/weights/best.pt
      --img-size 640 --batch-size  1 --opset 12 --topk-per-class 100 --topk-all 100
      --iou-thres 0.45 --conf-thres 0.25 --include coreml --verbose
    deps:
    - path: runs/train/weights/best.pt
      md5: 7cbc508453eb0c255d45eb8c843bd356
      size: 14641469
    outs:
    - path: runs/train/weights/best.mlmodel
      md5: bd97581aded4701402221bd951d7c279
      size: 29321907
  exports@1:
    cmd: docker run --ipc=host  -v $(pwd)/datasets:/usr/src/datasets -v "$(pwd)"/runs:/usr/src/app/runs  yolov5-dvc:latest
      python3 export.py  --data data_configs/coco128.yaml --weights runs/train/weights/best.pt
      --img-size 640 --batch-size  1 --opset 12 --topk-per-class 100 --topk-all 100
      --iou-thres 0.45 --conf-thres 0.25 --include onnx --verbose
    deps:
    - path: runs/train/weights/best.pt
      md5: 7cbc508453eb0c255d45eb8c843bd356
      size: 14641469
    outs:
    - path: runs/train/weights/best.onnx
      md5: 2c9e5a0fe9ec23ac59bd93df12779a1e
      size: 29352431
  exports@0:
    cmd: docker run --ipc=host  -v $(pwd)/datasets:/usr/src/datasets -v "$(pwd)"/runs:/usr/src/app/runs  yolov5-dvc:latest
      python3 export.py  --data data_configs/coco128.yaml --weights runs/train/weights/best.pt
      --img-size 640 --batch-size  1 --opset 12 --topk-per-class 100 --topk-all 100
      --iou-thres 0.45 --conf-thres 0.25 --include torchscript --verbose
    deps:
    - path: runs/train/weights/best.pt
      md5: 7cbc508453eb0c255d45eb8c843bd356
      size: 14641469
    outs:
    - path: runs/train/weights/best.torchscript
      md5: 4a188588b65894db4b9ee8e801e8135e
      size: 29378005
